// –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∞–ª—å–±–æ–º–æ–≤
const albums = {
    kurgan: {
        name: '–ö—É—Ä–≥–∞–Ω',
        folder: 'https://res.cloudinary.com/diqfvgfo3/image/upload/v1771873617',
        photos: ['1_glioca', '10_i5txzw', '12_qt3bni', '13_pmphnn', '16_gyo2ns', '17_guka4e', '2_xla1gd', '20_kqrrqg', '41_wkt4sh', '42_vqre3t', '43_j5if9e', '5_bofudc', '6_dx1qhd', '7_jci2rf', '8_mmekqi', '9_skydbm', 'IMG_1052_zurrkx', 'IMG_1053_nzs0tn', 'IMG_1055_iwvzbb', 'IMG_1063_h0xlcy', 'IMG_1067_jhljxn', 'IMG_1068_qsikep', 'IMG_1078_zw0u9y', 'IMG_1080_nrnyfp', 'IMG_1086_nul8b0', 'IMG_1088_irt6zp', 'IMG_1097_qnwfzm', 'IMG_1104_mnunav', 'IMG_1115_wwvbzw', 'IMG_1117_rbgire', 'IMG_1127_lnqb3j', 'IMG_1130_yhhnuc', 'IMG_1154_kdvnoe', 'IMG_1155_uyadoj', 'IMG_1157_jyadd0', 'IMG_1184_mqvddv', 'IMG_1186_o42mge', 'IMG_1217_umkwnr', 'IMG_1218_jb0qca', 'IMG_1247_xgpyzt', 'IMG_1263_ldpq5r', 'IMG_1267_ih1sli', 'IMG_1272_tjw5ha', 'IMG_1273_fc08wb', 'IMG_1298_gybqfc', 'IMG_1311_npxl0g', 'IMG_1338_syrx42', 'IMG_1344_izxtlv', 'IMG_1352_mti9k9', 'IMG_1355_w271j5', 'IMG_1365_tzxgym', 'IMG_1375_ua3afx', 'IMG_1384_xs98sd', 'IMG_1390_aw29f2', 'IMG_1394_atnhyb', 'IMG_1401_lxs61u', 'IMG_1514_pglfcr', 'IMG_1531_ai5e8z', 'IMG_1544_hpnylc', 'IMG_1557_cweyjr', 'IMG_1564_lnpzf5', 'IMG_1600_lm5kko', 'IMG_2175_p8r7qe']
    },
    tyumen: {
        name: '–¢—é–º–µ–Ω—å',
        folder: 'https://res.cloudinary.com/diqfvgfo3/image/upload/v1771873617',
        photos: ['1_rrhc5s', '2_bhmqmm', '14_l32oen', '16_yy4pg6', '19_ebuwlz', '20_pwvx3g', '21_pltpq8', '3_lqvphc', '4_erxjnc', '47_ekfaqh', '48_r3bazr', '58_yv0uyb', '59_rwnarb', '60_gusk1f', '61_mf74gw', '62_ibosic', '63_cuma1y', '64_hianzf', '65_lygq5g', '66_lfo3zq', '67_p6jkcq', '68_cyubwt', '69_xplbro', '70_aegi0m', '71_uwqqke', '72_hbu8xk']
    },
    dolmatovo: {
        name: '–î–æ–ª–º–∞—Ç–æ–≤–æ',
        folder: 'https://res.cloudinary.com/diqfvgfo3/image/upload/v1771873617',
        photos: ['IMG_1425_a3efrx', 'IMG_1437_aricwn', 'IMG_1438_t79rgd', 'IMG_1445_e65bx1', 'IMG_1450_wd4xmg', 'IMG_1458_yloeey', 'IMG_1461_fuan0e', 'IMG_1465_tit6a7', 'IMG_1473_gcifcj', 'IMG_1490_t5cm3f', 'IMG_1491_mipanv']
    },
    wedding: {
        name: '–°–≤–∞–¥—å–±–∞',
        folder: 'https://res.cloudinary.com/diqfvgfo3/image/upload/v1771873617',
        photos: ['0001_uskgvf.jpg', '0002_n52jva.jpg', '0003_wnz5ky.jpg', '0004_z9llps.jpg', '0005_ecp24t.jpg', '0006_wf4fje', '0007_joxo2k', '0008_fyb9hm', '0009_iblbf8', '0010_utz5fv', '0011_jig9fd', '0012_yhyaw7', '0013_qdwmc7', '0014_ukjniy', '0015_jiaqey', '0016_ifrrhl', '0017_ivhvwg', '0018_jnjgxb', '0019_wysupj', '0020_cstebx', '0021_ce7yk1', '0022_muxobt', '0023_aean5b', '0024_pfkyd7', '0025_ribm3f', '0026_geef9n', '0027_pddm6n', '0028_jr4sk3', '0029_zwwpn7', '0030_oc3h0q', '0031_eny8tl', '0032_cdekvx', '0033_vrrcs9', '0034_z0vw2d', '0035_nomxem', '0036_q9o6hj', '0037_ffwudp', '0038_llqgjo', '0039_zrgwcj', '0040_mhp6tf', '0041_jzrse2', '0042_domebu', '0043_kwplhu', '0044_kycyvb', '0045_mpeeia', '0046_gqjstx', '0047_v6ousq', '0048_gwq9a3', '0049_ut9uvx', '0050_ny4qnq', '0051_abslgr', '0052_hcxdjn', '0053_wvis3k', '0054_ghct2v', '0055_xdfucz', '0056_dz2snn', '0057_psw4mb', '0058_w3cwly', '0059_por1ve', '0060_izycrn', '0061_lwlurg', '0062_hcg4jo', '0063_ccuvsn', '0064_rn5ipt', '0065_tt44w9', '0066_qdbiqg', '0067_w3zd4a', '0068_qwykl1', '0069_l8cmny', '0070_d6tfrm', '0071_d71urd', '0072_dyhcch', '0073_t2g9r9', '0074_bcwbw2', '0075_nkwlbw', '0076_ogc0mz', '0077_qxiy06', '0078_jdlhsw', '0079_scykdt', '0080_jqcc7t', '0081_gmyuiq', '0082_etdakl', '0083_buqrgw', '0084_mtipq3', '0085_svyw2n', '0086_iupsm9', '0087_achmgv', '0088_lr7qep', '0089_k13rkk', '0090_mlabz3', '0091_zwetyw', '0092_cmwn6t', '0093_sar61v', '0094_zua2tb', '0095_xjbcmj', '0096_fci9v9', '0097_idpfyq', '0098_m4zc4b', '0099_pq0iwe', '0100_ng6ynf', '0101_xlhovm', '0102_xbtcpj', '0103_mfvp2w', '0104_sitoti', '0105_vemx1g', '0106_refwsv', '0107_wiaist', '0108_nkwy94', '0109_vketl7', '0110_oc3cyu', '0111_ecepxj', '0112_wieood', '0113_p6exib', '0114_yg9qlg', '0115_lqvgfl', '0116_b62efi', '0117_kpvpxv', '0118_fwz7xh', '0119_a2e1ma', '0120_stcrs7', '0121_jc9qbb', '0122_fcmpql', '0123_ur1eu0', '0124_pfdal5', '0125_msy7xl', '0126_q3wbcj', '0127_mmmjqv', '0128_zmuh6u', '0129_frzawx', '0130_schz4n', '0131_izsl7d', '0132_krgz9f', '0133_uqj5vd', '0134_at0scw', '0135_srrvnj', '0136_gzzado', '0137_lohhre', '0138_b2nmjd', '0139_agsfzl', '0140_vsrqtx', '0141_xcyfu4', '0142_qxqwff', '0143_nfyopi', '0144_xhqtm7', '0145_xoahoo', '0146_htx8qf', '0147_ejjtxa', '0148_ielz76', '0149_c4oxcc', '0150_hqa2yp', '0151_hiemy6', '0152_cmne3d', '0153_t5fhpf', '0154_yfxksx', '0155_vvjtls', '0156_yrgolm', '0157_ep4hdy', '0158_agynzl', '0159_iwe2tr', '0160_imjrjh', '0161_qkjzdk', '0162_mqgfz2', '0163_lbodd0', '0164_aeanwx', '0165_f6u2dt', '0166_lpnpit', '0167_j26xh6', '0168_o3k5iq', '0169_ggtn4j', '0170_mpzpxm', '0171_juwtq7', '0172_dsgmqe', '0173_noa6eu', '0174_mfbvh5', '0175_s1olwi', '0176_n4karn', '0177_kxwchb', '0178_y1l21w', '0179_o7nm9r', '0180_atbxkq', '0181_upnyeh', '0182_aetjbo', '0183_yidscj', '0184_hes5cc', '0185_hxixlb', '0186_jgmv7x', '0187_bteytn', '0188_pqjpce', '0189_fuxz3p', '0190_xo4gsw']
    },
    other: {
        name: '–ù–µ–≤–æ—à–µ–¥—à–µ–µ',
        folder: 'photos/–ù–µ–≤–æ—à–µ–¥—à–µ–µ',
        photos: ['5436068101876743088_121.jpg', '5436101349218580697_121.jpg']
    }
};

// –î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ –æ—Ç–Ω–æ—à–µ–Ω–∏–π (–∏–∑–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à—É –¥–∞—Ç—É)
const relationshipStartDate = new Date('2024-08-25');

// ============================================
// –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –í–ê–ñ–ù–´–• –î–ê–¢
// ============================================
const importantDates = {
    met: new Date('2018-10-26'),      // –î–∞—Ç–∞ –∑–Ω–∞–∫–æ–º—Å—Ç–≤–∞
    dating: new Date('2024-08-25'),   // –î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ –æ—Ç–Ω–æ—à–µ–Ω–∏–π
    wedding: new Date('2025-05-15')   // –î–∞—Ç–∞ —Å–≤–∞–¥—å–±—ã
};

// ============================================
// –ó–ê–ü–ò–°–ö–ò –í –ö–û–ù–í–ï–†–¢–´ (–æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ç–µ–∫—Å—Ç –∑–¥–µ—Å—å)
// ============================================
const notes = {
    met: {
        his: `–ó–¥–µ—Å—å –±—É–¥–µ—Ç –≤–∞—à–∞ –∑–∞–ø–∏—Å–∫–∞ –æ –¥–Ω–µ –∑–Ω–∞–∫–æ–º—Å—Ç–≤–∞...\n\n–ù–∞–ø–∏—à–∏—Ç–µ —Å–≤–æ–∏ –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ —Ç–æ–º, –∫–∞–∫ –≤—ã –ø–æ–∑–Ω–∞–∫–æ–º–∏–ª–∏—Å—å.`,
        her: `–ó–¥–µ—Å—å –±—É–¥–µ—Ç –µ—ë –∑–∞–ø–∏—Å–∫–∞ –æ –¥–Ω–µ –∑–Ω–∞–∫–æ–º—Å—Ç–≤–∞...\n\n–û–Ω–∞ —Å–º–æ–∂–µ—Ç –Ω–∞–ø–∏—Å–∞—Ç—å —Å–≤–æ–∏ –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ–± —ç—Ç–æ–º –¥–Ω–µ.`
    },
    dating: {
        his: `–ó–¥–µ—Å—å –±—É–¥–µ—Ç –≤–∞—à–∞ –∑–∞–ø–∏—Å–∫–∞ –æ –Ω–∞—á–∞–ª–µ –æ—Ç–Ω–æ—à–µ–Ω–∏–π...\n\n–û–ø–∏—à–∏—Ç–µ –≤–∞—à–∏ —á—É–≤—Å—Ç–≤–∞ –∏ –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ —Ç–æ–º –¥–Ω–µ, –∫–æ–≥–¥–∞ –≤—ã –Ω–∞—á–∞–ª–∏ –≤—Å—Ç—Ä–µ—á–∞—Ç—å—Å—è.`,
        her: `–ó–¥–µ—Å—å –±—É–¥–µ—Ç –µ—ë –∑–∞–ø–∏—Å–∫–∞ –æ –Ω–∞—á–∞–ª–µ –æ—Ç–Ω–æ—à–µ–Ω–∏–π...\n\n–ï—ë –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ —Ç–æ–º, –∫–∞–∫ –≤—Å—ë –Ω–∞—á–∏–Ω–∞–ª–æ—Å—å.`
    },
    wedding: {
        his: `–ó–¥–µ—Å—å –±—É–¥–µ—Ç –≤–∞—à–∞ –∑–∞–ø–∏—Å–∫–∞ –æ –¥–Ω–µ —Å–≤–∞–¥—å–±—ã...\n\n–í–∞—à–∏ —ç–º–æ—Ü–∏–∏, —á—É–≤—Å—Ç–≤–∞ –∏ –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ —Å–∞–º–æ–º –≤–∞–∂–Ω–æ–º –¥–Ω–µ.`,
        her: `–ó–¥–µ—Å—å –±—É–¥–µ—Ç –µ—ë –∑–∞–ø–∏—Å–∫–∞ –æ –¥–Ω–µ —Å–≤–∞–¥—å–±—ã...\n\n–ï—ë –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ —Å–≤–∞–¥–µ–±–Ω–æ–º –¥–Ω–µ.`
    }
};

// ============================================
// –õ–Æ–ë–ò–ú–´–ï –§–†–ê–ó–´ (–¥–æ–±–∞–≤–ª—è–π—Ç–µ –Ω–æ–≤—ã–µ —Ñ—Ä–∞–∑—ã —Å—é–¥–∞)
// ============================================
const favoritePhrases = [
    '–î–æ–¥–æ—Ö',
    '–Ø –∫–æ–≥–¥–∞ —Ç–æ—Ä–æ–ø–ª—é—Å—å, —è –±–µ–≥–∞—é',
    '–ß–º–æ–Ω—è',
    '–ù–µ —â—ë–ª–∫–∞–π —Ö–ª–µ–±–∞–ª—å–Ω–∏—á–∫–æ–º',
		'–ú—ã –ø–æ—Å–æ–≤–µ—â–∞–ª–∏—Å—å –∏ —è —Ä–µ—à–∏–ª–∞',
		'–ö–æ—Ç —Å–¥–æ—Ö–Ω—É–ª–∞',
		'–ü–µ—Ä–µ–≥–æ–≤–æ—Ä—ã –≤–æ–∑–Ω–∞–±–Ω–∞–±–ª—è—Ç',
		'–ß–µ—Ö–æ–ª–µ'
];

// –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
let currentAlbum = null;
let currentPhotos = [];
let currentIndex = 0;

// DOM —ç–ª–µ–º–µ–Ω—Ç—ã
const lightbox = document.getElementById('lightbox');
const lightboxImg = document.getElementById('lightbox-img');
const lightboxCaption = document.getElementById('lightbox-caption');
const lightboxCounter = document.getElementById('lightbox-counter');
const lightboxProgress = document.getElementById('lightbox-progress');
const lightboxThumbnails = document.getElementById('lightbox-thumbnails');
const lightboxClose = document.querySelector('.lightbox-close');
const lightboxPrev = document.querySelector('.lightbox-prev');
const lightboxNext = document.querySelector('.lightbox-next');

// –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –∑–∞–ø–∏—Å–æ–∫
let currentNoteDate = null;

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
document.addEventListener('DOMContentLoaded', () => {
    createParticles();
    loadAllAlbums();
    setupNavigation();
    setupLightbox();
    updateYear();
    updateDaysCounter();
    setupScrollAnimations();
    setupParallax();
    updateImportantDates();
    loadFavoritePhrases();
});

// –°–æ–∑–¥–∞–Ω–∏–µ —á–∞—Å—Ç–∏—Ü –¥–ª—è hero-—Å–µ–∫—Ü–∏–∏
function createParticles() {
    const particlesContainer = document.getElementById('hero-particles');
    const particleCount = 30;

    for (let i = 0; i < particleCount; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        
        const size = Math.random() * 15 + 5;
        particle.style.width = `${size}px`;
        particle.style.height = `${size}px`;
        particle.style.left = `${Math.random() * 100}%`;
        
        const duration = Math.random() * 10 + 10;
        const delay = Math.random() * 10;
        particle.style.animationDuration = `${duration}s`;
        particle.style.animationDelay = `${delay}s`;
        
        particlesContainer.appendChild(particle);
    }
}

// –°—á—ë—Ç—á–∏–∫ –¥–Ω–µ–π –≤–º–µ—Å—Ç–µ
function updateDaysCounter() {
    const daysElement = document.getElementById('days-count');
    if (!daysElement) return;

    const today = new Date();
    const diffTime = Math.abs(today - relationshipStartDate);
    const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
    
    // –ê–Ω–∏–º–∞—Ü–∏—è —Å—á—ë—Ç—á–∏–∫–∞
    animateCounter(daysElement, 0, diffDays, 2000);
}

function animateCounter(element, start, end, duration) {
    const range = end - start;
    const startTime = performance.now();

    function update(currentTime) {
        const elapsed = currentTime - startTime;
        const progress = Math.min(elapsed / duration, 1);
        
        // Easing function
        const easeOutQuart = 1 - Math.pow(1 - progress, 4);
        const current = Math.floor(start + range * easeOutQuart);
        
        element.textContent = current.toLocaleString('ru-RU');
        
        if (progress < 1) {
            requestAnimationFrame(update);
        }
    }

    requestAnimationFrame(update);
}

// Fade-in –∞–Ω–∏–º–∞—Ü–∏—è –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ
function setupScrollAnimations() {
    const observerOptions = {
        root: null,
        rootMargin: '0px',
        threshold: 0.1
    };

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('visible');
            }
        });
    }, observerOptions);

    document.querySelectorAll('.fade-in-section').forEach(section => {
        observer.observe(section);
    });
}

// –ü–∞—Ä–∞–ª–ª–∞–∫—Å —ç—Ñ—Ñ–µ–∫—Ç –¥–ª—è hero
function setupParallax() {
    const hero = document.querySelector('.hero');
    const heroContent = document.querySelector('.hero-content');
    
    window.addEventListener('scroll', () => {
        const scrolled = window.pageYOffset;
        if (hero && heroContent && scrolled < hero.offsetHeight) {
            heroContent.style.transform = `translate(-50%, calc(-50% + ${scrolled * 0.3}px))`;
            heroContent.style.opacity = 1 - (scrolled / hero.offsetHeight);
        }
    });
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –∞–ª—å–±–æ–º–æ–≤
function loadAllAlbums() {
    for (const [key, album] of Object.entries(albums)) {
        loadAlbum(key, album);
    }
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –∞–ª—å–±–æ–º–∞
function loadAlbum(albumKey, album) {
    const gridElement = document.getElementById(`grid-${albumKey}`);
    const countElement = document.getElementById(`count-${albumKey}`);

    if (!gridElement) return;

    const photos = album.photos.map(filename => ({
        src: `${album.folder}/${filename}`,
        name: decodeURIComponent(filename.replace(/\.[^.]+$/, ''))
    }));

    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á—ë—Ç—á–∏–∫
    if (countElement) {
        countElement.textContent = `${photos.length} —Ñ–æ—Ç–æ`;
    }

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–æ—Ç–æ –¥–ª—è –∞–ª—å–±–æ–º–∞
    window[`photos_${albumKey}`] = photos;

    // –†–µ–Ω–¥–µ—Ä–∏–º –º–∏–Ω–∏–∞—Ç—é—Ä—ã
    renderPhotos(gridElement, photos, albumKey);
}

// –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π
function renderPhotos(container, photos, albumKey) {
    container.innerHTML = '';

    if (photos.length === 0) {
        container.innerHTML = `
            <div class="empty-album">
                <p>üì∑ –î–æ–±–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –≤ –ø–∞–ø–∫—É <strong>photos/${albums[albumKey].name}</strong></p>
            </div>
        `;
        return;
    }

    photos.forEach((photo, index) => {
        const item = document.createElement('div');
        item.className = 'photo-item fade-in-section';
        item.innerHTML = `
            <img src="${photo.src}" alt="${photo.name}" loading="lazy">
        `;
        item.addEventListener('click', () => openLightbox(albumKey, index));
        container.appendChild(item);
    });

    // –ü–µ—Ä–µ—Å–æ–∑–¥–∞—ë–º observer –¥–ª—è –Ω–æ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('visible');
            }
        });
    }, { threshold: 0.1 });

    container.querySelectorAll('.photo-item').forEach(item => {
        observer.observe(item);
    });
}

// –¢–µ–∫—É—â–∏–π –∞–∫—Ç–∏–≤–Ω—ã–π –∞–ª—å–±–æ–º
let currentViewedAlbum = null;

// –ü–æ–∫–∞–∑–∞—Ç—å –∞–ª—å–±–æ–º
function showAlbum(albumKey) {
    currentViewedAlbum = albumKey;
    
    document.querySelectorAll('.album-section').forEach(section => {
        section.style.display = 'none';
    });
    
    const targetSection = document.getElementById(albumKey);
    if (targetSection) {
        targetSection.style.display = 'block';
        targetSection.classList.add('visible');
        setTimeout(() => {
            targetSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }, 50);
    }
}

// –°–∫—Ä—ã—Ç—å –≤—Å–µ –∞–ª—å–±–æ–º—ã
function hideAllAlbums() {
    currentViewedAlbum = null;
    document.querySelectorAll('.album-section').forEach(section => {
        section.style.display = 'none';
    });
}

// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
function setupNavigation() {
    // –ö–ª–∏–∫ –ø–æ –∫–∞—Ä—Ç–æ—á–∫–∞–º –∞–ª—å–±–æ–º–æ–≤
    document.querySelectorAll('.album-card').forEach(card => {
        card.addEventListener('click', (e) => {
            e.preventDefault();
            const albumKey = card.getAttribute('data-album');
            if (albumKey && albums[albumKey]) {
                showAlbum(albumKey);
                window.location.hash = albumKey;
            }
        });
    });

    // –ö–Ω–æ–ø–∫–∞ —Å–∫—Ä–æ–ª–ª–∞ –∫ –∞–ª—å–±–æ–º–∞–º
    const scrollButton = document.querySelector('.scroll-down');
    if (scrollButton) {
        scrollButton.addEventListener('click', (e) => {
            e.preventDefault();
            const albumsNav = document.querySelector('.albums-nav');
            if (albumsNav) {
                albumsNav.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        });
    }

    // –ö–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥ –∫ –∞–ª—å–±–æ–º–∞–º"
    document.querySelectorAll('.back-to-albums').forEach(btn => {
        btn.addEventListener('click', (e) => {
            e.preventDefault();
            hideAllAlbums();
            window.location.hash = '';
            const albumsNav = document.querySelector('.albums-nav');
            if (albumsNav) {
                albumsNav.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        });
    });

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è hash
    let hashChangeTimeout = null;
    window.addEventListener('hashchange', () => {
        const hash = window.location.hash.slice(1);
        
        // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Ç–∞–π–º–∞—É—Ç
        if (hashChangeTimeout) clearTimeout(hashChangeTimeout);
        
        if (!hash || hash === ' ') {
            hideAllAlbums();
            return;
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ hash —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∞–ª—å–±–æ–º—É
        if (albums[hash]) {
            // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
            hashChangeTimeout = setTimeout(() => {
                if (currentViewedAlbum !== hash) {
                    showAlbum(hash);
                }
            }, 50);
        }
    });

    // –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    const initialHash = window.location.hash.slice(1);
    if (initialHash && albums[initialHash]) {
        showAlbum(initialHash);
    } else {
        hideAllAlbums();
    }
}

// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–∞–π—Ç–±–æ–∫—Å–∞
function setupLightbox() {
    lightboxClose.addEventListener('click', closeLightbox);
    lightboxPrev.addEventListener('click', () => navigatePhoto(-1));
    lightboxNext.addEventListener('click', () => navigatePhoto(1));

    lightbox.addEventListener('click', (e) => {
        if (e.target === lightbox) {
            closeLightbox();
        }
    });

    document.addEventListener('keydown', (e) => {
        if (!lightbox.classList.contains('active')) return;

        switch (e.key) {
            case 'Escape':
                closeLightbox();
                break;
            case 'ArrowLeft':
                navigatePhoto(-1);
                break;
            case 'ArrowRight':
                navigatePhoto(1);
                break;
        }
    });
}

// –û—Ç–∫—Ä—ã—Ç–∏–µ –ª–∞–π—Ç–±–æ–∫—Å–∞
function openLightbox(albumKey, index) {
    const photos = window[`photos_${albumKey}`];
    if (!photos || photos.length === 0) return;

    currentAlbum = albumKey;
    currentIndex = index;
    currentPhotos = photos;

    createThumbnails(index);
    updateLightboxImage();
    lightbox.classList.add('active');
    document.body.style.overflow = 'hidden';
}

// –°–æ–∑–¥–∞–Ω–∏–µ –º–∏–Ω–∏–∞—Ç—é—Ä
function createThumbnails(activeIndex) {
    lightboxThumbnails.innerHTML = '';

    currentPhotos.forEach((photo, idx) => {
        const thumb = document.createElement('div');
        thumb.className = `lightbox-thumb ${idx === activeIndex ? 'active' : ''}`;
        thumb.innerHTML = `<img src="${photo.src}" alt="${photo.name}">`;
        thumb.addEventListener('click', function() {
            currentIndex = idx;
            updateLightboxImage();
        });
        lightboxThumbnails.appendChild(thumb);
    });
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–∏–Ω–∏–∞—Ç—é—Ä
function updateThumbnails() {
    document.querySelectorAll('.lightbox-thumb').forEach((thumb, index) => {
        thumb.classList.toggle('active', index === currentIndex);
    });
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –ª–∞–π—Ç–±–æ–∫—Å–µ
function updateLightboxImage() {
    if (!currentPhotos[currentIndex]) return;

    const photo = currentPhotos[currentIndex];
    
    // –ê–Ω–∏–º–∞—Ü–∏—è —Å–º–µ–Ω—ã —Ñ–æ—Ç–æ
    lightboxImg.style.opacity = '0';
    lightboxImg.style.transform = 'scale(0.95)';
    
    setTimeout(() => {
        lightboxImg.src = photo.src;
        lightboxImg.style.opacity = '1';
        lightboxImg.style.transform = 'scale(1)';
    }, 150);
    
    lightboxCaption.textContent = photo.name;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á—ë—Ç—á–∏–∫
    const current = currentIndex + 1;
    const total = currentPhotos.length;
    lightboxCounter.textContent = `${current} / ${total}`;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä
    const progress = (current / total) * 100;
    lightboxProgress.style.width = `${progress}%`;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –º–∏–Ω–∏–∞—Ç—é—Ä—ã
    updateThumbnails();
}

// –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Ñ–æ—Ç–æ
function navigatePhoto(direction) {
    if (!currentPhotos.length) return;

    currentIndex += direction;
    if (currentIndex < 0) currentIndex = currentPhotos.length - 1;
    if (currentIndex >= currentPhotos.length) currentIndex = 0;

    updateLightboxImage();
}

// –ó–∞–∫—Ä—ã—Ç–∏–µ –ª–∞–π—Ç–±–æ–∫—Å–∞
function closeLightbox() {
    lightbox.classList.remove('active');
    document.body.style.overflow = '';
    setTimeout(() => {
        lightboxImg.src = '';
    }, 300);
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≥–æ–¥–∞ –≤ —Ñ—É—Ç–µ—Ä–µ
function updateYear() {
    const yearElement = document.querySelector('.footer-year');
    if (yearElement) {
        yearElement.textContent = `¬© ${new Date().getFullYear()} –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã`;
    }
}

// ============================================
// –§–£–ù–ö–¶–ò–ò –î–õ–Ø –í–ê–ñ–ù–´–• –î–ê–¢
// ============================================

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á—ë—Ç—á–∏–∫–æ–≤ –¥–Ω–µ–π –¥–ª—è –≤–∞–∂–Ω—ã—Ö –¥–∞—Ç
function updateImportantDates() {
    const today = new Date();
    
    // –î–∞—Ç–∞ –∑–Ω–∞–∫–æ–º—Å—Ç–≤–∞
    const metDaysElement = document.getElementById('date-met-days');
    if (metDaysElement) {
        const metDays = Math.floor((today - importantDates.met) / (1000 * 60 * 60 * 24));
        animateCounter(metDaysElement, 0, metDays, 2000);
    }
    
    // –î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ –æ—Ç–Ω–æ—à–µ–Ω–∏–π
    const datingDaysElement = document.getElementById('date-dating-days');
    if (datingDaysElement) {
        const datingDays = Math.floor((today - importantDates.dating) / (1000 * 60 * 60 * 24));
        animateCounter(datingDaysElement, 0, datingDays, 2000);
    }
    
    // –î–∞—Ç–∞ —Å–≤–∞–¥—å–±—ã
    const weddingDaysElement = document.getElementById('date-wedding-days');
    if (weddingDaysElement) {
        const weddingDays = Math.floor((today - importantDates.wedding) / (1000 * 60 * 60 * 24));
        animateCounter(weddingDaysElement, 0, weddingDays, 2000);
    }
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –ª—é–±–∏–º—ã—Ö —Ñ—Ä–∞–∑
function loadFavoritePhrases() {
    const container = document.getElementById('phrases-container');
    if (!container) return;
    
    container.innerHTML = '';
    
    favoritePhrases.forEach((phrase, index) => {
        const phraseCard = document.createElement('div');
        phraseCard.className = 'phrase-card fade-in-section';
        phraseCard.style.animationDelay = `${index * 0.1}s`;
        
        const phraseText = document.createElement('p');
        phraseText.className = 'phrase-text';
        phraseText.textContent = phrase;
        
        phraseCard.appendChild(phraseText);
        container.appendChild(phraseCard);
    });
    
    // –ü–µ—Ä–µ—Å–æ–∑–¥–∞—ë–º observer –¥–ª—è –Ω–æ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('visible');
            }
        });
    }, { threshold: 0.1 });
    
    container.querySelectorAll('.phrase-card').forEach(card => {
        observer.observe(card);
    });
}

// –û—Ç–∫—Ä—ã—Ç–∏–µ/–∑–∞–∫—Ä—ã—Ç–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏ —Å –¥–∞—Ç–æ–π
function toggleDateCard(dateKey) {
    const card = document.querySelector(`.date-card[data-date="${dateKey}"]`);
    if (!card) return;
    
    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –¥—Ä—É–≥–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏
    document.querySelectorAll('.date-card').forEach(c => {
        if (c !== card) {
            c.classList.remove('expanded');
        }
    });
    
    // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º —Ç–µ–∫—É—â—É—é
    card.classList.toggle('expanded');
}

// –û—Ç–∫—Ä—ã—Ç–∏–µ –∫–æ–Ω–≤–µ—Ä—Ç–∞
function openEnvelope(envelopeElement, author, dateKey) {
    // –ï—Å–ª–∏ –∫–æ–Ω–≤–µ—Ä—Ç —É–∂–µ –æ—Ç–∫—Ä—ã—Ç, –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
    if (envelopeElement.classList.contains('opened')) return;
    
    // –û—Ç–∫—Ä—ã–≤–∞–µ–º –∫–æ–Ω–≤–µ—Ä—Ç
    envelopeElement.classList.add('opened');
    
    // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—Å—Ç –∑–∞–ø–∏—Å–∫–∏
    const noteText = notes[dateKey][author];
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–ø–∏—Å–∫—É —Å –Ω–µ–±–æ–ª—å—à–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π
    setTimeout(() => {
        showNote(noteText);
    }, 400);
}

// –ü–æ–∫–∞–∑ –∑–∞–ø–∏—Å–∫–∏
function showNote(text) {
    const noteDisplay = document.getElementById('note-display');
    const noteTextElement = document.getElementById('note-text');
    
    if (!noteDisplay || !noteTextElement) return;
    
    noteTextElement.textContent = text;
    noteDisplay.classList.add('active');
    document.body.style.overflow = 'hidden';
}

// –ó–∞–∫—Ä—ã—Ç–∏–µ –∑–∞–ø–∏—Å–∫–∏
function closeNote() {
    const noteDisplay = document.getElementById('note-display');
    if (!noteDisplay) return;
    
    noteDisplay.classList.remove('active');
    document.body.style.overflow = '';
    
    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –∫–æ–Ω–≤–µ—Ä—Ç—ã
    document.querySelectorAll('.envelope').forEach(env => {
        env.classList.remove('opened');
    });
    
    currentNoteDate = null;
}

// –ó–∞–∫—Ä—ã—Ç–∏–µ –∑–∞–ø–∏—Å–∫–∏ –ø–æ –∫–ª–∏–∫—É –Ω–∞ —Ñ–æ–Ω
document.addEventListener('click', (e) => {
    if (e.target.classList.contains('note-display')) {
        closeNote();
    }
});

// –ó–∞–∫—Ä—ã—Ç–∏–µ –∑–∞–ø–∏—Å–∫–∏ –ø–æ Escape
document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
        closeNote();
    }
});
